<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Beautiful Screens - Admin</title>
    <link rel="icon" type="image/png" href="/static/logo.png">
    <link rel="stylesheet" href="/static/admin.css">
    {% if clerk_publishable_key %}
    <script
        data-clerk-publishable-key="{{ clerk_publishable_key }}"
        src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"
        async
    ></script>
    {% endif %}
</head>
<body>
    <div class="container">
        <div class="admin-header">
            <div class="header-title">
                <img src="/static/logo.png" alt="BBS Logo" class="header-logo">
                <div>
                    <h1>Big Beautiful Screens</h1>
                    <p class="subtitle">Admin Dashboard</p>
                </div>
            </div>
        </div>

        <div class="actions">
            <button id="create-screen" class="btn-primary">+ Create New Screen</button>
            <div class="nav-links">
                <a href="/admin/themes" class="nav-link">Themes</a>
                <a href="/admin/media" class="nav-link">Media</a>
                {% if clerk_publishable_key %}
                <a href="/admin/usage" class="nav-link">Usage & Billing</a>
                <a href="#" class="nav-link" onclick="signOut(); return false;">Sign Out</a>
                {% endif %}
            </div>
        </div>

        <div class="screen-list">
            {% if screens %}
                {% for screen in screens %}
                <div class="screen-card" data-screen-id="{{ screen.id }}" data-api-key="{{ screen.api_key }}" data-screen-url="{{ screen.screen_url }}" data-api-url="{{ screen.api_url }}">
                    <div class="card-header" onclick="toggleExpand(this.parentElement)">
                        <div class="card-summary">
                            <span class="screen-name {{ 'unnamed' if screen.is_unnamed else '' }}" onclick="editName(this, event)" title="Click to edit name">{{ screen.name_display }}</span>
                            <code class="screen-id">{{ screen.id }}</code>
                            <a href="{{ screen.screen_url }}" target="_blank" class="screen-link" onclick="event.stopPropagation()">
                                <span class="link-icon">‚Üó</span> <span class="screen-link-text">{{ screen.screen_url }}</span>
                            </a>
                            {% if screen.name_display == 'Welcome Demo' %}
                            <span class="demo-indicator" onclick="event.stopPropagation()">
                                <span class="demo-indicator-arrow">üëà</span>
                                <span class="demo-indicator-text">Click to view demo!</span>
                            </span>
                            {% endif %}
                            <span class="viewer-badge">{{ screen.viewer_count }} viewer{{ 's' if screen.viewer_count != 1 else '' }}</span>
                        </div>
                        <span class="expand-icon">‚ñº</span>
                    </div>
                    <div class="card-details">
                        <div class="detail-grid">
                            <div class="detail-item">
                                <label>API Key</label>
                                <div class="detail-value">
                                    <code class="api-key">{{ screen.api_key }}</code>
                                    <button class="btn-icon copy-api-key" onclick="copyValue(this, '{{ screen.api_key }}')" title="Copy API Key">üìã</button>
                                </div>
                            </div>
                            <div class="detail-item">
                                <label>API Endpoint</label>
                                <div class="detail-value">
                                    <code class="api-url">{{ screen.api_url }}</code>
                                    <button class="btn-icon copy-api-url" onclick="copyValue(this, BASE_URL + '{{ screen.api_url }}')" title="Copy API URL">üìã</button>
                                </div>
                            </div>
                        </div>
                        <div class="detail-section">
                            <label>Custom Head HTML <span class="hint">(for Google Fonts, etc.)</span></label>
                            <textarea class="head-html-input" placeholder="<link rel=&quot;preconnect&quot; href=&quot;https://fonts.googleapis.com&quot;>
<link href=&quot;https://fonts.googleapis.com/css2?family=...&quot; rel=&quot;stylesheet&quot;>" onclick="event.stopPropagation()">{{ screen.head_html or '' }}</textarea>
                            <p class="warning-text">Warning: Custom HTML including scripts is injected directly into your screen. Only add code from sources you trust.</p>
                            <button class="btn-secondary btn-save-head" onclick="saveHeadHtml('{{ screen.id }}', this); event.stopPropagation();">Save Head HTML</button>
                        </div>
                        <div class="detail-footer">
                            <div class="detail-timestamps">
                                <span>Created: <span class="created-time">{{ screen.created_display }}</span></span>
                                <span>Last Updated: <span class="updated-time">{{ screen.last_updated_display }}</span></span>
                            </div>
                            <div class="detail-actions">
                                <div class="action-dropdown">
                                    <button class="btn-secondary" onclick="toggleDropdown(this); event.stopPropagation();">Copy Example ‚ñæ</button>
                                    <div class="dropdown-menu">
                                        <button onclick="copyExample(this, 'bash')">Bash / cURL</button>
                                        <button onclick="copyExample(this, 'python')">Python</button>
                                    </div>
                                </div>
                                <div class="action-dropdown">
                                    <button class="btn-secondary" onclick="toggleDropdown(this); event.stopPropagation();">Screen Actions ‚ñæ</button>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <button onclick="viewJson('{{ screen.id }}', '{{ screen.api_key }}'); event.stopPropagation();">View JSON</button>
                                        <button class="btn-debug" onclick="toggleDebug('{{ screen.id }}', '{{ screen.api_key }}'); event.stopPropagation();">Toggle Debug</button>
                                        <button class="btn-reload" onclick="reloadScreen('{{ screen.id }}', '{{ screen.api_key }}'); event.stopPropagation();">Reload Viewers</button>
                                        <button class="btn-duplicate" onclick="duplicateScreen('{{ screen.id }}', '{{ screen.api_key }}'); event.stopPropagation();">Duplicate Screen</button>
                                        <button class="btn-delete" onclick="deleteScreen('{{ screen.id }}', '{{ screen.api_key }}'); event.stopPropagation();">Delete Screen</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty">No screens yet. Create one to get started!</div>
            {% endif %}
        </div>

        {% if total_pages > 1 %}
        <div class="pagination">
            <span class="page-info">Page {{ page }} of {{ total_pages }} ({{ total_count }} screens)</span>
            <div class="page-controls">
                <a href="?page={{ page - 1 }}" class="btn-secondary{{ ' disabled' if page <= 1 else '' }}">‚Üê Previous</a>
                <a href="?page={{ page + 1 }}" class="btn-secondary{{ ' disabled' if page >= total_pages else '' }}">Next ‚Üí</a>
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        const BASE_URL = window.location.origin;

        // Toast notification system
        function showToast(message, type = 'success', duration = 3000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            if (type === 'loading') {
                toast.innerHTML = `<div class="toast-spinner"></div><span>${message}</span>`;
            } else {
                const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : '';
                toast.innerHTML = `<span>${icon}</span><span>${message}</span>`;
            }

            container.appendChild(toast);

            // Return a function to dismiss this toast (for loading toasts)
            const dismiss = () => {
                toast.classList.add('hiding');
                setTimeout(() => toast.remove(), 300);
            };

            if (type !== 'loading' && duration > 0) {
                setTimeout(dismiss, duration);
            }

            return dismiss;
        }

        // Helper to get Clerk session token for API calls (SaaS mode)
        // Returns empty headers in self-hosted mode where Clerk isn't loaded
        async function getAuthHeaders() {
            if (typeof Clerk === 'undefined') return {};

            // Wait for Clerk to be ready if needed
            if (!Clerk.loaded) await Clerk.load();
            if (!Clerk.session) return {};

            try {
                const token = await Clerk.session.getToken();
                if (token) {
                    return { 'Authorization': `Bearer ${token}` };
                }
            } catch (e) {
                console.error('[Auth] Error getting token:', e);
            }
            return {};
        }

        async function signOut() {
            if (typeof Clerk !== 'undefined' && Clerk.loaded) {
                await Clerk.signOut();
            }
            window.location.href = '/auth/logout';
        }

        document.getElementById('create-screen').addEventListener('click', async () => {
            const btn = document.getElementById('create-screen');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'Creating...';

            const authHeaders = await getAuthHeaders();
            const response = await fetch('/api/v1/screens', {
                method: 'POST',
                headers: authHeaders,
                credentials: 'include'
            });

            btn.disabled = false;
            btn.textContent = originalText;

            if (!response.ok) {
                const error = await response.json().catch(() => ({}));
                showToast(error.detail || 'Failed to create screen', 'error');
                return;
            }
            const data = await response.json();

            // Create and insert new screen card
            const screenList = document.querySelector('.screen-list');
            const emptyMessage = screenList.querySelector('.empty');
            if (emptyMessage) emptyMessage.remove();

            const card = createScreenCard(data);
            screenList.insertBefore(card, screenList.firstChild);
            card.classList.add('expanded');
            showToast('Screen created', 'success');
        });

        function createScreenCard(data) {
            const template = document.getElementById('screen-card-template');
            const card = template.content.firstElementChild.cloneNode(true);

            const now = new Date().toISOString().slice(0, 19).replace('T', ' ');

            // Set data attributes
            card.dataset.screenId = data.screen_id;
            card.dataset.apiKey = data.api_key;
            card.dataset.screenUrl = data.screen_url;
            card.dataset.apiUrl = data.api_url;

            // Update content
            card.querySelector('.screen-id').textContent = data.screen_id;
            card.querySelector('.screen-link').href = data.screen_url;
            card.querySelector('.screen-link-text').textContent = data.screen_url;
            card.querySelector('.api-key').textContent = data.api_key;
            card.querySelector('.api-url').textContent = data.api_url;
            card.querySelector('.created-time').textContent = now;

            // Set screen name if provided
            const nameEl = card.querySelector('.screen-name');
            if (data.name && data.name !== 'Unnamed Screen') {
                nameEl.textContent = data.name;
                nameEl.classList.remove('unnamed');
            }

            // Update onclick handlers with actual values
            card.querySelector('.copy-api-key').onclick = function() { copyValue(this, data.api_key); };
            card.querySelector('.copy-api-url').onclick = function() { copyValue(this, BASE_URL + data.api_url); };
            card.querySelector('.btn-save-head').onclick = function(e) { e.stopPropagation(); saveHeadHtml(data.screen_id, this); };
            card.querySelector('.btn-view-json').onclick = function(e) { e.stopPropagation(); viewJson(data.screen_id, data.api_key); };
            card.querySelector('.btn-debug').onclick = function(e) { e.stopPropagation(); toggleDebug(data.screen_id, data.api_key); };
            card.querySelector('.btn-reload').onclick = function(e) { e.stopPropagation(); reloadScreen(data.screen_id, data.api_key); };
            card.querySelector('.btn-duplicate').onclick = function(e) { e.stopPropagation(); duplicateScreen(data.screen_id, data.api_key); };
            card.querySelector('.btn-delete').onclick = function(e) { e.stopPropagation(); deleteScreen(data.screen_id, data.api_key); };

            return card;
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.copy-dropdown') && !e.target.closest('.action-dropdown')) {
                document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
        });

        function toggleExpand(card) {
            card.classList.toggle('expanded');
        }

        function toggleDropdown(btn) {
            const menu = btn.nextElementSibling;
            const wasOpen = menu.classList.contains('show');

            // Close all other dropdowns
            document.querySelectorAll('.dropdown-menu.show').forEach(m => {
                m.classList.remove('show');
            });

            // Toggle this one
            if (!wasOpen) {
                menu.classList.add('show');
            }
        }

        function getCardData(el) {
            const card = el.closest('.screen-card');
            return {
                screenId: card.dataset.screenId,
                apiKey: card.dataset.apiKey,
                screenUrl: card.dataset.screenUrl,
                apiUrl: card.dataset.apiUrl
            };
        }

        function copyValue(btn, value) {
            navigator.clipboard.writeText(value).then(() => {
                const original = btn.textContent;
                btn.textContent = '‚úì';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = original;
                    btn.classList.remove('copied');
                }, 1000);
            });
            event.stopPropagation();
        }

        function copyExample(btn, type) {
            const data = getCardData(btn);
            let text = '';

            if (type === 'bash') {
                text = `curl -X POST ${BASE_URL}${data.apiUrl} \\
  -H "Content-Type: application/json" \\
  -H "X-API-Key: ${data.apiKey}" \\
  -d '{"content": ["Hello, World!"]}'`;
            } else if (type === 'python') {
                text = `import requests

response = requests.post(
    "${BASE_URL}${data.apiUrl}",
    headers={"X-API-Key": "${data.apiKey}"},
    json={"content": ["Hello, World!"]}
)
print(response.json())`;
            }

            navigator.clipboard.writeText(text).then(() => {
                const original = btn.textContent;
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = original;
                    btn.classList.remove('copied');
                    btn.closest('.dropdown-menu').classList.remove('show');
                }, 1000);
            });
            event.stopPropagation();
        }

        async function reloadScreen(screenId, apiKey) {
            const dismiss = showToast('Reloading viewers...', 'loading');
            try {
                const response = await fetch(`/api/v1/screens/${screenId}/reload`, {
                    method: 'POST',
                    headers: { 'X-API-Key': apiKey }
                });
                dismiss();
                const data = await response.json();
                if (response.ok) {
                    showToast(`Reload sent to ${data.viewers_reloaded} viewer(s)`, 'success');
                } else {
                    showToast('Failed to reload: ' + (data.detail || 'Unknown error'), 'error');
                }
            } catch (error) {
                dismiss();
                showToast('Failed to reload: ' + error.message, 'error');
            }
        }

        async function viewJson(screenId, apiKey) {
            const dismiss = showToast('Loading JSON...', 'loading');
            try {
                const response = await fetch(`/api/v1/screens/${screenId}/pages`, {
                    headers: { 'X-API-Key': apiKey }
                });
                dismiss();
                if (!response.ok) {
                    showToast('Failed to fetch screen data', 'error');
                    return;
                }
                const data = await response.json();
                const modal = document.getElementById('json-modal');
                const content = document.getElementById('json-content');
                content.textContent = JSON.stringify(data, null, 2);
                modal.style.display = 'flex';
            } catch (error) {
                dismiss();
                showToast('Failed to fetch: ' + error.message, 'error');
            }
        }

        function closeJsonModal() {
            document.getElementById('json-modal').style.display = 'none';
        }

        function copyJson() {
            const content = document.getElementById('json-content').textContent;
            navigator.clipboard.writeText(content);
            const btn = document.querySelector('#json-modal .btn-primary');
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = 'Copy JSON', 1500);
        }

        async function toggleDebug(screenId, apiKey) {
            const dismiss = showToast('Toggling debug...', 'loading');
            try {
                // Server handles state - just send toggle request
                const response = await fetch(`/api/v1/screens/${screenId}/debug?enabled=toggle`, {
                    method: 'POST',
                    headers: { 'X-API-Key': apiKey }
                });
                dismiss();
                const data = await response.json();
                if (response.ok) {
                    showToast(`Debug ${data.debug_enabled ? 'enabled' : 'disabled'} for ${data.viewers} viewer(s)`, 'success');
                } else {
                    showToast('Failed to toggle debug: ' + (data.detail || 'Unknown error'), 'error');
                }
            } catch (error) {
                dismiss();
                showToast('Failed to toggle debug: ' + error.message, 'error');
            }
        }

        async function deleteScreen(screenId, apiKey) {
            if (!confirm('Are you sure you want to delete this screen? This action cannot be undone.')) {
                return;
            }

            const dismiss = showToast('Deleting screen...', 'loading');
            try {
                const response = await fetch(`/api/v1/screens/${screenId}`, {
                    method: 'DELETE',
                    headers: { 'X-API-Key': apiKey }
                });
                dismiss();
                if (response.ok) {
                    // Remove card from DOM
                    const card = document.querySelector(`[data-screen-id="${screenId}"]`);
                    if (card) {
                        card.remove();
                        // Show empty message if no screens left
                        const screenList = document.querySelector('.screen-list');
                        if (!screenList.querySelector('.screen-card')) {
                            screenList.innerHTML = '<div class="empty">No screens yet. Create one to get started!</div>';
                        }
                    }
                    showToast('Screen deleted', 'success');
                } else {
                    const data = await response.json();
                    showToast('Failed to delete: ' + (data.detail || 'Unknown error'), 'error');
                }
            } catch (error) {
                dismiss();
                showToast('Failed to delete: ' + error.message, 'error');
            }
        }

        async function duplicateScreen(screenId, apiKey) {
            const dismiss = showToast('Duplicating screen...', 'loading');
            try {
                const response = await fetch(`/api/v1/screens/${screenId}/duplicate`, {
                    method: 'POST',
                    headers: { 'X-API-Key': apiKey }
                });
                dismiss();
                const data = await response.json();
                if (response.ok) {
                    // Create and insert new screen card
                    const screenList = document.querySelector('.screen-list');
                    const card = createScreenCard(data);
                    screenList.insertBefore(card, screenList.firstChild);
                    card.classList.add('expanded');
                    showToast('Screen duplicated', 'success');
                } else {
                    showToast('Failed to duplicate: ' + (data.detail || 'Unknown error'), 'error');
                }
            } catch (error) {
                dismiss();
                showToast('Failed to duplicate: ' + error.message, 'error');
            }
        }

        async function saveHeadHtml(screenId, btn) {
            const card = btn.closest('.screen-card');
            const apiKey = card.dataset.apiKey;
            const textarea = card.querySelector('.head-html-input');
            const headHtml = textarea.value;

            try {
                btn.disabled = true;
                btn.textContent = 'Saving...';

                const response = await fetch(`/api/v1/screens/${screenId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': apiKey
                    },
                    body: JSON.stringify({ head_html: headHtml })
                });

                if (response.ok) {
                    btn.textContent = 'Saved!';
                    showToast('Head HTML saved', 'success');
                    setTimeout(() => {
                        btn.textContent = 'Save Head HTML';
                        btn.disabled = false;
                    }, 1500);
                } else {
                    const data = await response.json();
                    showToast('Failed to save: ' + (data.detail || 'Unknown error'), 'error');
                    btn.textContent = 'Save Head HTML';
                    btn.disabled = false;
                }
            } catch (error) {
                showToast('Failed to save: ' + error.message, 'error');
                btn.textContent = 'Save Head HTML';
                btn.disabled = false;
            }
        }

        function editName(el, event) {
            event.stopPropagation();
            const card = el.closest('.screen-card');
            const screenId = card.dataset.screenId;
            const apiKey = card.dataset.apiKey;
            const currentName = el.classList.contains('unnamed') ? '' : el.textContent;

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'name-input';
            input.value = currentName;
            input.placeholder = 'Enter screen name...';

            const saveName = async () => {
                const newName = input.value.trim();
                try {
                    const response = await fetch(`/api/v1/screens/${screenId}`, {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-API-Key': apiKey
                        },
                        body: JSON.stringify({ name: newName || null })
                    });
                    if (response.ok) {
                        el.textContent = newName || 'Unnamed Screen';
                        el.classList.toggle('unnamed', !newName);
                    }
                } catch (error) {
                    console.error('Failed to update name:', error);
                }
                input.replaceWith(el);
            };

            input.addEventListener('blur', saveName);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    input.blur();
                }
                if (e.key === 'Escape') {
                    input.value = currentName;
                    input.blur();
                }
            });

            el.replaceWith(input);
            input.focus();
            input.select();
        }
    </script>

    <!-- JSON View Modal -->
    <div id="json-modal" class="modal" onclick="if(event.target === this) closeJsonModal()">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Screen Data (JSON)</h2>
                <button class="modal-close" onclick="closeJsonModal()">&times;</button>
            </div>
            <div class="modal-body">
                <pre id="json-content" class="json-display"></pre>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeJsonModal()">Close</button>
                <button class="btn-primary" onclick="copyJson()">Copy JSON</button>
            </div>
        </div>
    </div>

    <!-- Template for new screen cards (cloned by JavaScript) -->
    <template id="screen-card-template">
        <div class="screen-card">
            <div class="card-header" onclick="toggleExpand(this.parentElement)">
                <div class="card-summary">
                    <span class="screen-name unnamed" onclick="editName(this, event)" title="Click to edit name">Unnamed Screen</span>
                    <code class="screen-id"></code>
                    <a href="#" target="_blank" class="screen-link" onclick="event.stopPropagation()">
                        <span class="link-icon">‚Üó</span> <span class="screen-link-text"></span>
                    </a>
                    <span class="viewer-badge">0 viewers</span>
                </div>
                <span class="expand-icon">‚ñº</span>
            </div>
            <div class="card-details">
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>API Key</label>
                        <div class="detail-value">
                            <code class="api-key"></code>
                            <button class="btn-icon copy-api-key" title="Copy API Key">üìã</button>
                        </div>
                    </div>
                    <div class="detail-item">
                        <label>API Endpoint</label>
                        <div class="detail-value">
                            <code class="api-url"></code>
                            <button class="btn-icon copy-api-url" title="Copy API URL">üìã</button>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <label>Custom Head HTML <span class="hint">(for Google Fonts, etc.)</span></label>
                    <textarea class="head-html-input" placeholder="<link rel=&quot;preconnect&quot; href=&quot;https://fonts.googleapis.com&quot;>
<link href=&quot;https://fonts.googleapis.com/css2?family=...&quot; rel=&quot;stylesheet&quot;>" onclick="event.stopPropagation()"></textarea>
                    <p class="warning-text">Warning: Custom HTML including scripts is injected directly into your screen. Only add code from sources you trust.</p>
                    <button class="btn-secondary btn-save-head">Save Head HTML</button>
                </div>
                <div class="detail-footer">
                    <div class="detail-timestamps">
                        <span>Created: <span class="created-time"></span></span>
                        <span>Last Updated: <span class="updated-time">Never</span></span>
                    </div>
                    <div class="detail-actions">
                        <div class="action-dropdown">
                            <button class="btn-secondary" onclick="toggleDropdown(this); event.stopPropagation();">Copy Example ‚ñæ</button>
                            <div class="dropdown-menu">
                                <button onclick="copyExample(this, 'bash')">Bash / cURL</button>
                                <button onclick="copyExample(this, 'python')">Python</button>
                            </div>
                        </div>
                        <div class="action-dropdown">
                            <button class="btn-secondary" onclick="toggleDropdown(this); event.stopPropagation();">Screen Actions ‚ñæ</button>
                            <div class="dropdown-menu dropdown-menu-right">
                                <button class="btn-view-json">View JSON</button>
                                <button class="btn-debug">Toggle Debug</button>
                                <button class="btn-reload">Reload Viewers</button>
                                <button class="btn-duplicate">Duplicate Screen</button>
                                <button class="btn-delete">Delete Screen</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Footer -->
    <footer class="page-footer">
        <div class="footer-links">
            <a href="/docs" target="_blank" class="footer-link">
                <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h6v6h6v10H6z"/></svg>
                API Docs
            </a>
            <a href="https://github.com/anthonyeden/big-beautiful-screens" target="_blank" class="footer-link">
                <svg viewBox="0 0 24 24"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/></svg>
                GitHub
            </a>
        </div>
    </footer>

    <!-- Help Button -->
    <div class="help-container">
        <span class="help-text">{{ help_text }}</span>
        <a href="{{ help_url }}" target="_blank" class="help-button" title="Get Help">?</a>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <style>
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .toast {
            background: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            max-width: 350px;
        }
        .toast.success { background: #22c55e; }
        .toast.error { background: #ef4444; }
        .toast.loading { background: #3b82f6; }
        .toast-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .toast.hiding {
            animation: slideOut 0.3s ease forwards;
        }
    </style>
</body>
</html>
